# <center>Redis学习</center>

# 1、Redis优势与应用场景
&emsp;&emsp;Redis为内存数据库，相对于传统的关系型数据库其最大的优势在于速度快。由于存储在内存中，因此相对与传统数据库仅能保存一定量的数据。根据Redis优势应用场景包括：
- 1、缓存，注意缓存数据与数据库数据保持一致，更新数据库时要同步更新缓存
- 2、分布式数据共享，Redis独立与应用程序，因此可以实现数据共享
- 3、分布式锁，string类型Redis数据如果存在则set不成功，保证锁唯一被获得，还可以设置过期机制。
- 4、全局ID，int类型，
- 5、消息队列
- 6、统计

&emsp;&emsp;Redis部署方式主要包括：
- 1、单机版
- 2、分布式，主从，人为进行主从切换
- 3、哨兵，哨兵进行主从切换

&emsp;&emsp;Redis的主要数据类型：
- 1、字符串
- 2、列表
- 3、散列
- 4、集合
- 5、有序集合

# 2、Redis采用的协议
&emsp;&emsp;Redis采用的协议为RESP，是一种文本协议。该协议存在以下优点：简单、解析速度快（比json解析快）、可读性好。RESP设计了5中数据类型：简单字符串、error、整数、长字符串（小于512M）以及数组。RESP中用一个字符表示当前的数据类型，解码器需要按照数据类型对其进行解码。所有的数据类型都以`\r\n`结尾，数组的元素之间也是用`\r\n`结尾。

| 类型 | 字符 | 其他 |
| ---- | ---- | --- |
| 简单字符串 | + | 后跟字符串 |
| error	| - | 错误信息 |
| 整数	| ： | 整数 |
| 长字符串	| $ | 字符长度\r\n具体内容 |
| 数组	| * | 数组长度\r\n具体内容 |

redis的具体指令在RESP中也是通过数组进行解析的，如`set test1 1`通过RESP包装为`*3\r\n$3\r\nset\r\n$5\r\ntest1\r\n$1\r\n1\r\n`

# 3、Redis持久化
&emsp;&emsp;Redis为内存数据库，如果Redis崩溃，或是系统宕机，Redis中的数据则全部丢失，为了防止数据丢失或减少数据丢失需要对Redis中的数据落盘即为持久化。Redis提供两种持久化数据的方案，分别为创建快照以及AOF。生成快照以及AOF文件之后需要对其进行备份。  
&emsp;&emsp;1）创建快照可以通过设置多长时间设置一次，但如果在创建快照过程中Redis或系统崩溃，则会出现部分数据丢失情况。创建快照会消耗部分计算资源，影响服务器性能。在生成快照过程中redis可能会出现停顿，save命令在主进程中运行不会创建子进程，因此比bgsave会更快些。  
&emsp;&emsp;2）AOF即将每个Redis写命令追加到文件中，当Redis重启时遍历AOF中所有的命令，依次执行一遍，完成数据的导入。AOF写入太频繁因磁盘的效率低会严重影响Redis性能。推荐使用everysec，即每秒将命令批量追加到文件中。不会影响Redis的效率，如果出现异常状态，仅会丢失1秒内的数据。AOF相对于快照持久化速度更快。但随着写入命令的增多，AOF文件会不断增大，数据恢复过程也会变得很慢。可以对AOF进行瘦身bgrewriteaof命令，会新启一个进程进行去重，生成新的AOF文件删除旧的文件。因此如果AOF很大也会存在停顿。

# 4、复制
&emsp;&emsp;单个实例的Redis存在性能瓶颈，因此通过水平扩展增强Redis能力。通过主从部署，将主节点的数据复制到从服务器上。写操作在主节点进行，读操作可以在主节点以及从节点进行。主从启动过程中，主节点创建数据快照，并将快照发送给从服务器，从服务器加载快照的数据。启动之后主节点的每个写命令都会发送给从服务器，完成数据的复制。


# 3、实战
&emsp;&emsp;用java实现Redis，采用netty进行通信、按照协议解析命令、针对不同的命令实现具体功能。