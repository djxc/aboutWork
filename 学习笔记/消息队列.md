# 消息队列学习
消息队列用来进行消息的订阅与消息发布，可以用来削峰填谷以及服务解耦。常见的消息队列包括Kafka、RocketMq、mqtt等。

## kafka
kafka是一个流平台，可以进行数据流的发布以及订阅，并把数据保存起来进行处理。kafka是一个分布式系统可以进行灵活的伸缩。kafka消息成批次发送，可以提高网络传输效率，相应的会带来时间延迟。主题相当于一个文件夹，可以被分为多个分区。一个主题如果有多个分区不能保证在多个分区上消息的顺序性，仅可保证在单个分区的顺序性。在每个分区中消息的偏移量是唯一的，消费者最后读取的消息偏移量保存在zookeeper或kafka中，以供下次读取时使用。消费群组为多个消费者集合，共同消费同一个主题的消息，其中一个消费者消费了一个消息后，其他消费者不会再次消费该条消息。群组保证每个分区仅能被一个消费者消费, 而一个消费者可以消费多个分区。消费者与分区的映射关系称为消费者对分区的所有权关系。
- 1、kafka多个集群之间进行消息的复制，形成多个数据中心，需要采用mirrorMaker工具。
- 2、kafka集群中有一个broker充当集群控制器角色，将分区分给broker并监控broker。一个分区从属于一个broker，该broker成为该分区的首领，其他broker复制分区的数据，提供高可用。
- 3、kafka主题创建时分区默认为1，分区可以增加但不可减少。
- 4、kafka生产者发送消息具有三种方式，发送并忘记、同步发送以及异步发送。生产者配置，acks让多少broker接收到才算消息写入成功；


- 5、rebalance，一个topic如果有多个分区，一个消费组中各个消费者如何绑定到分区，需要rebalance机制。rebalance触发机制为：1）组成员发生变更；2）组订阅的topic数发生变更；3）订阅的topic分区发生变更。