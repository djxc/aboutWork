# 一、空天云管理平台记录
## 1、UI
## 2、功能前端
## 3、功能后端


# 二、、定位手环
## 1、UI
主要包含两个按钮：  
&emsp;1、实时定位；  
&emsp;2、当天轨迹;  
弹出实时定位详细信息，用户点击实时定位点，在弹出的面板中显示用户的实时信息：**id**、**经纬度**、**定位是否有效**、**方向**、**时间**、**日期**、**速度**以及**电量**。
## 2、前端
## 3、后端
&emsp;1) 数据获取阶段采用nodejs编写的socket服务器，定位手环每隔几分钟向服务器发送一个socket请求，携带定位的详细信息。然后，断开连接，等下次发送数据时在建立socket连接。定位手环发送的数据不都是定位相关的数据，还有包含其他的数据。因此，需要通过正则表达式判断发送的数据是否是定位相关的数据，是否以\*HQ开头。通过正则表达筛选符合条件的定位数据，然后对其进行解析。因为，发送过来的数据不友好、阅读不便，也是更好的进行持久化。解析完数据，将其插入数据库中。
&emsp;2) 数据库选择的是postgresql，为了更快的进行数据库的操作，使用数据库连接池。首先，创建数据库连接池；当有数据需要进行插入的时候触发pool的connect事件，回调函数有client参数，执行增、删、改、查等操作时需要对client进行操作。当执行完增删改查等操作之后需要调用release()函数用来释放连接。


# 三、阿里云具体操作
## 1、创建git仓库
&emsp;阿里云仓库存储位置为/srv/目录下，因此需要在/srv/目录下进行操作：  
&emsp;&emsp;1) 首先在git服务器上创建裸仓库 git init --bare xxx.git  
&emsp;&emsp;2) 修改仓库所有者以及群组为git，chown git xxx.git -R,  chgrp git xxx.git -R  
&emsp;&emsp;3) 拉取仓库到本地, git clone git@47.105.161.92:/srv/xxx.git  
&emsp;每次提交都会需要输入密码，可以将客户机的公钥放入放在git服务器的/home/git/.ssh/authorized_keys,一行一个(需要启用git用户的bash--在/etc/passwd文件git:x:503:503::/home/git:/bin/git-shell改为git:x:503:503::/home/git:/bin/bash，加入公钥之后修改回来，防止git用户登录)。这样提交修改就不用输入密码了。  
&emsp;生成公钥ssh-keygen -t rsa -C "youremail@example.com"添加公钥，开启git用户的bash，在/home/git/.ssh/authorized_keys中添加公钥  
### 阿里云账户 用户名: dj_jxc 密   码: 123bhqd321
### centOS 用户名: root 密   码: 123Dj321 用户名: bhqd 密   码: 123dj321 ip：47.105.161.92
### geoserver端口8081 用户名：admin 密   码：123dj321 nohup ./start.sh	后台运行geoserver关闭窗口不退出
### postgresql 端口 用户名: dj 密   码: 123dj321


# 四、标注工具系统

## 1、UI
&emsp;网页前端采用React + Ant Design框架。  
&emsp;&emsp;1) 构建系统地图显示、数据查看、标注编辑弹出框等用户友好的交互界面。  

## 2、卫星影像数据显示与管理
&emsp; 地图显示采用geoserver + Mapbox  
&emsp;&emsp;1) 通过geoserver将大数据量的卫星数据进行切片，方便大数据量的卫星数据快速加载。  
&emsp;&emsp;2) 利用Mapbox库进行地图的加载与显示，提供卫星图像的放大、缩小、拖放等功能；加载显示用户已标注的矢量要素；支持用户在线标注功能，标注可以提供矩形、多边形以及圆形等样式。  
&emsp;&emsp;3) 提供所有卫星影像数据列表，列表中显示卫星影像详细信息。用户通过点击卫星影像列表，跳转显示该卫星影像数据以及对应的标注数据。  
## 3、数据库
&emsp;标注分为几何数据以及属性数据：几何数据采用postgresql数据库；属性数据采用mongodb数据库。几何数据与属性数据具有一一对应关系。  
&emsp;&emsp;1) 矢量格式编辑的标注，存储在postgresql数据库中，postgresql数据库支持空间数据库的扩展，postgresql数据库中定义唯一标示字段用于与属性数据进行挂接。  
&emsp;&emsp;2) 标注属性数据，由于支持用户自定义扩展因此需要采用nosql数据库进行存储，因此采用mongodb数据库进行存储属性信息，支持不同数据具有不同的字段类型，适用于用户对标注信息扩展。mongodb数据表具有唯一标识字段与postgresql对应。  
&emsp;&emsp;3) 对数据增加事务管理，实现不同用户同时操作相同数据时，保证数据正确性。  
&emsp;&emsp;4) 如果数据库访问太大，可以增加一层Redis数据库缓存，提高数据的效率。  
## 4、标注显示与编辑
&emsp;标注信息包括为几何信息与属性信息，通过网络获取标注信息，利用mapbox进行显示；提供用户在线编辑。  
&emsp;&emsp;1) 显示标注信息，根据用户选择不同的卫星影像数据，通过sql语句查询对应的标注信息，进行显示。  
&emsp;&emsp;2) 根据不同类型以及不同状态的标注显示不同的颜色以及形状。不同类型的标签在mapbox设置feature不同颜色边框显示；标签具有不同的状态：待审核以及通过审核，待审核将mapbox中的feature设为虚线，通过审核将feature边框设为实心线。  
&emsp;&emsp;3) 支持用户点击标签feature弹出overlay对话框，详细显示点击的feature详细信息，类型、名称、状态等等。  
&emsp;&emsp;4) 标注的编辑，提供编辑工具栏，标注的新建、修改、删除等操作。用户编辑新的标注即新创建feature，编辑结束后，弹出属性信息添加对话框，用户可以选择不同的模板，不同模板对应不同的属性字段。填写结束后保存，即将几何数据保存在postgresql数据库下；属性信息保存在mongodb数据库下。  
&emsp;&emsp;5) 标注导入与导出：用户可以将本地的标注导入到系统，用户选中本地的文件夹，通过JavaScript解析本地文件夹下的xml、json文件，解析到几何点数据，创建成新的feature并将其保存在postgresql数据库中，将其属性信息保存在mongodb数据库中。标注的导出  

## 5、权限管理

## 6、报表管理
&emsp;采用Antd Design以及Echarts等网页端可视化库进行报表的显示。  
&emsp;&emsp;1) 报表主要显示模型训练准确率、误判率等指标，以及所有标注的整体浏览。
&emsp;&emsp;1) 提供查询功能，用户可以根据需要进行多个条件进行查询，在数据库中获取响应数据，然后在网页端显示不同内容的报表。  
&emsp;&emsp;2) 支持报表的导出功能，生成jpg或png等图片，或是excel等文件保存在本地。  
